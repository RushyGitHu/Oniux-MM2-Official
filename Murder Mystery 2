local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TopBar = Instance.new("Frame")
local UICorner_2 = Instance.new("UICorner")
local Title = Instance.new("TextLabel")
local ContentFrame = Instance.new("Frame")

-- GUI Setup
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 120)
MainFrame.Position = UDim2.new(0.8, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0, 10)

TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

UICorner_2.Parent = TopBar
UICorner_2.CornerRadius = UDim.new(0, 10)

Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Grandma ESP"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TopBar

ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Create Toggle Button
local ESPToggle = Instance.new("TextButton")
ESPToggle.Size = UDim2.new(1, 0, 0, 35)
ESPToggle.Position = UDim2.new(0, 0, 0, 0)
ESPToggle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPToggle.Text = "ESP: OFF"
ESPToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPToggle.Font = Enum.Font.GothamBold
ESPToggle.TextSize = 14
ESPToggle.Parent = ContentFrame

local UICorner_3 = Instance.new("UICorner")
UICorner_3.CornerRadius = UDim.new(0, 6)
UICorner_3.Parent = ESPToggle

-- ESP Variables
local espEnabled = false
local espItems = {}

-- Update the item detection lists
local weaponsList = {
    "bazooka",
    "grenade",
    "molotov",
    "knife",
    "machete",
    "shovel",
    "hammer",
    "bowl",
    "bomb",
    "rocket",
    "rocketlauncher",
    "rock"
}

local consumablesList = {
    "potion",
    "soda",
    "medkit",
    "stamina",
    "shot"
}

local specialItemsList = {
    "key",
    "chest"
}

-- Update ESP Function with color coding
local function createESP(item)
    -- Check if ESP already exists for this item
    for _, esp in pairs(espItems) do
        if esp.item == item then
            return
        end
    end

    local highlight = Instance.new("Highlight")
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    
    -- Color coding based on item type
    local itemNameLower = item.Name:lower()
    local itemType = "other"
    local color
    
    -- Check weapon items (Red)
    for _, weapon in pairs(weaponsList) do
        if itemNameLower:find(weapon) then
            color = Color3.fromRGB(255, 0, 0)
            itemType = "Weapon"
            break
        end
    end
    
    -- Check consumable items (Green)
    if not color then
        for _, consumable in pairs(consumablesList) do
            if itemNameLower:find(consumable) then
                color = Color3.fromRGB(0, 255, 0)
                itemType = "Consumable"
                break
            end
        end
    end
    
    -- Check special items (Yellow)
    if not color then
        for _, special in pairs(specialItemsList) do
            if itemNameLower:find(special) then
                color = Color3.fromRGB(255, 255, 0)
                itemType = "Special"
                break
            end
        end
    end
    
    -- Default color (White)
    if not color then
        color = Color3.fromRGB(255, 255, 255)
    end
    
    highlight.FillColor = color
    highlight.OutlineColor = color
    highlight.Parent = item
    highlight.Enabled = espEnabled
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, 100, 0, 35)
    billboardGui.AlwaysOnTop = true
    billboardGui.StudsOffset = Vector3.new(0, 2, 0)
    billboardGui.Parent = item
    billboardGui.Enabled = espEnabled
    
    local itemLabel = Instance.new("TextLabel")
    itemLabel.Size = UDim2.new(1, 0, 0.6, 0)
    itemLabel.Position = UDim2.new(0, 0, 0, 0)
    itemLabel.BackgroundTransparency = 1
    itemLabel.Text = item.Name
    itemLabel.TextColor3 = color
    itemLabel.TextStrokeTransparency = 0
    itemLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    itemLabel.Font = Enum.Font.GothamBold
    itemLabel.TextSize = 12
    itemLabel.Parent = billboardGui
    
    local typeLabel = Instance.new("TextLabel")
    typeLabel.Size = UDim2.new(1, 0, 0.4, 0)
    typeLabel.Position = UDim2.new(0, 0, 0.6, 0)
    typeLabel.BackgroundTransparency = 1
    typeLabel.Text = itemType
    typeLabel.TextColor3 = color
    typeLabel.TextStrokeTransparency = 0
    typeLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    typeLabel.Font = Enum.Font.GothamBold
    typeLabel.TextSize = 10
    typeLabel.Parent = billboardGui
    
    table.insert(espItems, {
        item = item,
        highlight = highlight,
        billboard = billboardGui
    })
end

-- Update item detection function
local function shouldCreateESP(item)
    local itemNameLower = item.Name:lower()
    
    -- Check all item lists
    for _, weapon in pairs(weaponsList) do
        if itemNameLower:find(weapon) then
            return true
        end
    end
    
    for _, consumable in pairs(consumablesList) do
        if itemNameLower:find(consumable) then
            return true
        end
    end
    
    for _, special in pairs(specialItemsList) do
        if itemNameLower:find(special) then
            return true
        end
    end
    
    return false
end

-- Update Initialize ESP function
local function initializeESP()
    for _, item in pairs(workspace:GetDescendants()) do
        if (item:IsA("BasePart") or item:IsA("Model")) and shouldCreateESP(item) then
            createESP(item)
        end
    end
end

-- Update Watch for new items
workspace.DescendantAdded:Connect(function(item)
    if (item:IsA("BasePart") or item:IsA("Model")) and shouldCreateESP(item) then
        wait(0.1) -- Small delay to ensure the item is fully loaded
        createESP(item)
    end
end)

-- Toggle ESP Function
local function toggleESP()
    espEnabled = not espEnabled
    ESPToggle.Text = "ESP: " .. (espEnabled and "ON" or "OFF")
    ESPToggle.BackgroundColor3 = espEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(45, 45, 45)
    
    for _, esp in pairs(espItems) do
        if esp.highlight and esp.billboard then
            esp.highlight.Enabled = espEnabled
            esp.billboard.Enabled = espEnabled
        end
    end
end

ESPToggle.MouseButton1Click:Connect(toggleESP)

-- Make GUI draggable
local dragging
local dragInput
local dragStart
local startPos

local function updateDrag(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateDrag(input)
    end
end)

-- Add close button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = TopBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Initialize ESP
initializeESP() 
