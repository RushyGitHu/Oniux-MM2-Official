local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TopBar = Instance.new("Frame")
local UICorner_2 = Instance.new("UICorner")
local Title = Instance.new("TextLabel")
local ContentFrame = Instance.new("Frame")

-- GUI Setup
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 200, 0, 120)
MainFrame.Position = UDim2.new(0.8, 0, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0, 10)

TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

UICorner_2.Parent = TopBar
UICorner_2.CornerRadius = UDim.new(0, 10)

Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "Grandma ESP"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TopBar

ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Create Toggle Button
local ESPToggle = Instance.new("TextButton")
ESPToggle.Size = UDim2.new(1, 0, 0, 35)
ESPToggle.Position = UDim2.new(0, 0, 0, 0)
ESPToggle.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
ESPToggle.Text = "ESP: OFF"
ESPToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPToggle.Font = Enum.Font.GothamBold
ESPToggle.TextSize = 14
ESPToggle.Parent = ContentFrame

local UICorner_3 = Instance.new("UICorner")
UICorner_3.CornerRadius = UDim.new(0, 6)
UICorner_3.Parent = ESPToggle

-- ESP Variables
local espEnabled = false
local espItems = {}

-- ESP Function
local function createESP(item)
    -- Check if ESP already exists for this item
    for _, esp in pairs(espItems) do
        if esp.item == item then
            return
        end
    end

    local highlight = Instance.new("Highlight")
    highlight.FillTransparency = 0.5
    highlight.OutlineTransparency = 0
    highlight.FillColor = Color3.fromRGB(255, 255, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 165, 0)
    highlight.Parent = item
    highlight.Enabled = espEnabled
    
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Size = UDim2.new(0, 100, 0, 25)
    billboardGui.AlwaysOnTop = true
    billboardGui.StudsOffset = Vector3.new(0, 2, 0)
    billboardGui.Parent = item
    billboardGui.Enabled = espEnabled
    
    local itemLabel = Instance.new("TextLabel")
    itemLabel.Size = UDim2.new(1, 0, 1, 0)
    itemLabel.BackgroundTransparency = 1
    itemLabel.Text = item.Name
    itemLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    itemLabel.TextStrokeTransparency = 0
    itemLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    itemLabel.Font = Enum.Font.GothamBold
    itemLabel.TextSize = 12
    itemLabel.Parent = billboardGui
    
    table.insert(espItems, {
        item = item,
        highlight = highlight,
        billboard = billboardGui
    })
end

-- Toggle ESP Function
local function toggleESP()
    espEnabled = not espEnabled
    ESPToggle.Text = "ESP: " .. (espEnabled and "ON" or "OFF")
    ESPToggle.BackgroundColor3 = espEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(45, 45, 45)
    
    for _, esp in pairs(espItems) do
        if esp.highlight and esp.billboard then
            esp.highlight.Enabled = espEnabled
            esp.billboard.Enabled = espEnabled
        end
    end
end

ESPToggle.MouseButton1Click:Connect(toggleESP)

-- Make GUI draggable
local dragging
local dragInput
local dragStart
local startPos

local function updateDrag(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateDrag(input)
    end
end)

-- Add close button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = TopBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Initialize ESP for existing items
local function initializeESP()
    -- Look for items in the workspace
    for _, item in pairs(workspace:GetDescendants()) do
        -- Check for common item characteristics in Destroy Grandma
        if item:IsA("BasePart") or item:IsA("Model") then
            -- Check if it might be an item (you can add more specific checks)
            if item.Name:lower():find("key") or 
               item.Name:lower():find("tool") or 
               item.Name:lower():find("item") or
               item.Name:lower():find("collect") or
               item.Name:lower():find("pickup") then
                createESP(item)
            end
        end
    end
end

-- Watch for new items
workspace.DescendantAdded:Connect(function(item)
    if item:IsA("BasePart") or item:IsA("Model") then
        if item.Name:lower():find("key") or 
           item.Name:lower():find("tool") or 
           item.Name:lower():find("item") or
           item.Name:lower():find("collect") or
           item.Name:lower():find("pickup") then
            createESP(item)
        end
    end
end)

-- Clean up removed items
workspace.DescendantRemoving:Connect(function(item)
    for i, esp in pairs(espItems) do
        if esp.item == item then
            if esp.highlight then esp.highlight:Destroy() end
            if esp.billboard then esp.billboard:Destroy() end
            table.remove(espItems, i)
            break
        end
    end
end)

-- Initialize ESP
initializeESP() 
