-- MM2 Script with ESP, Teleports, Auto-shoot, and Fling
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Create GUI
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local UICorner = Instance.new("UICorner")
local TopBar = Instance.new("Frame")
local UICorner_2 = Instance.new("UICorner")
local Title = Instance.new("TextLabel")
local ContentFrame = Instance.new("Frame")
local UIListLayout = Instance.new("UIListLayout")

-- Create sections
local FlingSection = Instance.new("Frame")
local TeleportSection = Instance.new("Frame")

-- GUI Setup
ScreenGui.Parent = game.CoreGui
ScreenGui.ResetOnSpawn = false

MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

UICorner.Parent = MainFrame
UICorner.CornerRadius = UDim.new(0, 10)

TopBar.Name = "TopBar"
TopBar.Size = UDim2.new(1, 0, 0, 40)
TopBar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TopBar.BorderSizePixel = 0
TopBar.Parent = MainFrame

UICorner_2.Parent = TopBar
UICorner_2.CornerRadius = UDim.new(0, 10)

Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "MM2 Script"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TopBar

ContentFrame.Name = "ContentFrame"
ContentFrame.Size = UDim2.new(1, -20, 1, -50)
ContentFrame.Position = UDim2.new(0, 10, 0, 45)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

UIListLayout.Parent = ContentFrame
UIListLayout.Padding = UDim.new(0, 15)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Create styled button function
local function createStyledButton(text, parent)
    local button = Instance.new("TextButton")
    local uiCorner = Instance.new("UICorner")
    
    button.Size = UDim2.new(1, 0, 0, 45)
    button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamSemibold
    button.TextSize = 16
    button.AutoButtonColor = false
    button.Parent = parent
    
    uiCorner.CornerRadius = UDim.new(0, 6)
    uiCorner.Parent = button
    
    -- Button hover effect
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        }):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(45, 45, 45)
        }):Play()
    end)
    
    return button
end

-- Create sections
local function createSection(title)
    local section = Instance.new("Frame")
    local sectionTitle = Instance.new("TextLabel")
    local content = Instance.new("Frame")
    local listLayout = Instance.new("UIListLayout")
    
    section.Size = UDim2.new(1, 0, 0, 100)
    section.BackgroundTransparency = 1
    section.Parent = ContentFrame
    
    sectionTitle.Size = UDim2.new(1, 0, 0, 25)
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.Text = title
    sectionTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    sectionTitle.Font = Enum.Font.GothamBold
    sectionTitle.TextSize = 14
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.Parent = section
    
    content.Size = UDim2.new(1, 0, 1, -25)
    content.Position = UDim2.new(0, 0, 0, 25)
    content.BackgroundTransparency = 1
    content.Parent = section
    
    listLayout.Parent = content
    listLayout.Padding = UDim.new(0, 5)
    
    return content
end

-- Create sections
local flingContent = createSection("Fling")
local teleportContent = createSection("Teleports")

-- Create fling controls
local FlingInput = Instance.new("TextBox")
FlingInput.Size = UDim2.new(1, 0, 0, 45)
FlingInput.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
FlingInput.PlaceholderText = "ðŸ‘¤ Enter username to fling"
FlingInput.Text = ""
FlingInput.TextColor3 = Color3.fromRGB(255, 255, 255)
FlingInput.PlaceholderColor3 = Color3.fromRGB(180, 180, 180)
FlingInput.Font = Enum.Font.Gotham
FlingInput.TextSize = 16
FlingInput.Parent = flingContent

local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 6)
uiCorner.Parent = FlingInput

local FlingButton = createStyledButton("Fling Player", flingContent)
local StopFlingButton = createStyledButton("Stop Fling", flingContent)

-- Create teleport buttons
local TPGunButton = createStyledButton("TP to Gun", teleportContent)
local TPLobbyButton = createStyledButton("TP to Lobby", teleportContent)
local TPMapButton = createStyledButton("TP to Map", teleportContent)

-- Make GUI draggable for both PC and mobile
local dragging
local dragInput
local dragStart
local startPos

local function updateDrag(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

TopBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

TopBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        updateDrag(input)
    end
end)

-- ESP Function
local function createESP(player)
    local esp = Instance.new("BillboardGui")
    local espLabel = Instance.new("TextLabel")
    local espFrame = Instance.new("Frame")
    local nameLabel = Instance.new("TextLabel")
    local roleLabel = Instance.new("TextLabel")
    
    esp.Name = "ESP"
    esp.Size = UDim2.new(0, 200, 0, 50)
    esp.AlwaysOnTop = true
    esp.StudsOffset = Vector3.new(0, 2, 0)
    esp.MaxDistance = 150 -- Maximum distance to show ESP
    
    espFrame.Size = UDim2.new(1, 0, 1, 0)
    espFrame.BackgroundTransparency = 1
    espFrame.Parent = esp
    
    nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
    nameLabel.Position = UDim2.new(0, 0, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.TextSize = 14
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.Text = player.Name
    nameLabel.Parent = espFrame
    
    roleLabel.Size = UDim2.new(1, 0, 0.5, 0)
    roleLabel.Position = UDim2.new(0, 0, 0.5, 0)
    roleLabel.BackgroundTransparency = 1
    roleLabel.TextSize = 14
    roleLabel.Font = Enum.Font.GothamBold
    roleLabel.TextStrokeTransparency = 0
    roleLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    roleLabel.Parent = espFrame
    
    local function updateESP()
        if player.Character and player.Character:FindFirstChild("Head") then
            esp.Parent = player.Character.Head
            
            -- Update distance
            local distance = math.floor((LocalPlayer.Character.Head.Position - player.Character.Head.Position).Magnitude)
            nameLabel.Text = string.format("%s [%dm]", player.Name, distance)
            
            -- Check roles
            if player:FindFirstChild("Role") then
                if player.Role.Value == "Murderer" then
                    roleLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                    roleLabel.Text = "Murderer"
                    espFrame.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
                elseif player.Role.Value == "Sheriff" then
                    roleLabel.TextColor3 = Color3.fromRGB(0, 0, 255)
                    roleLabel.Text = "Sheriff"
                    espFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
                else
                    roleLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    roleLabel.Text = "Innocent"
                    espFrame.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
                end
            end
        end
    end
    
    updateESP()
    player.CharacterAdded:Connect(updateESP)
    
    -- Update ESP every 0.5 seconds for distance
    spawn(function()
        while wait(0.5) do
            if player.Character and LocalPlayer.Character then
                updateESP()
            end
        end
    end)
end

-- Auto-shoot murderer function
local function autoShootMurderer()
    local sheriff = nil
    local murderer = nil
    
    for _, player in pairs(Players:GetPlayers()) do
        if player:FindFirstChild("Role") then
            if player.Role.Value == "Murderer" then
                murderer = player
            elseif player.Role.Value == "Sheriff" then
                sheriff = player
            end
        end
    end
    
    if sheriff and sheriff == LocalPlayer and murderer then
        local gun = LocalPlayer.Character:FindFirstChild("Gun")
        if gun and murderer.Character then
            local rayOrigin = LocalPlayer.Character.Head.Position
            local rayDirection = (murderer.Character.Head.Position - rayOrigin).Unit
            local ray = Ray.new(rayOrigin, rayDirection * 100)
            local hit = workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character})
            
            if hit and hit:IsDescendantOf(murderer.Character) then
                gun.Shoot:FireServer(murderer.Character.Head.Position)
            end
        end
    end
end

-- Fling function
local originalPosition = nil
local isFlinging = false

local function flingPlayer(targetUsername)
    local target = Players:FindFirstChild(targetUsername)
    if target and target.Character then
        isFlinging = true
        originalPosition = LocalPlayer.Character.HumanoidRootPart.CFrame
        
        -- Set up for better flinging
        local oldVelocity = LocalPlayer.Character.HumanoidRootPart.Velocity
        local oldGyro = Instance.new("BodyGyro")
        oldGyro.P = 0
        oldGyro.MaxTorque = Vector3.new(0, 0, 0)
        oldGyro.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
        oldGyro.Parent = LocalPlayer.Character.HumanoidRootPart
        
        -- Disable character animations
        local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid:ChangeState(11)
        end
        
        while isFlinging and target.Character and target.Character:FindFirstChild("HumanoidRootPart") do
            -- Update position and velocity more aggressively
            LocalPlayer.Character.HumanoidRootPart.CFrame = target.Character.HumanoidRootPart.CFrame * CFrame.new(0, 0, 0.75)
            LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.new(9999, 9999, 9999)
            LocalPlayer.Character.HumanoidRootPart.RotVelocity = Vector3.new(9999, 9999, 9999)
            game:GetService("RunService").Heartbeat:Wait()
        end
        
        -- Clean up
        if oldGyro then
            oldGyro:Destroy()
        end
    else
        -- Notify if player not found
        local notification = Instance.new("TextLabel")
        notification.Text = "Player not found!"
        notification.Size = UDim2.new(1, 0, 0, 30)
        notification.Position = UDim2.new(0, 0, 0, -35)
        notification.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        notification.TextColor3 = Color3.fromRGB(255, 255, 255)
        notification.Font = Enum.Font.GothamBold
        notification.TextSize = 14
        notification.Parent = MainFrame
        
        game:GetService("Debris"):AddItem(notification, 2)
    end
end

-- Stop fling function
local function stopFling()
    isFlinging = false
    if originalPosition then
        -- Smoothly return to original position
        local tween = TweenService:Create(
            LocalPlayer.Character.HumanoidRootPart,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad),
            {CFrame = originalPosition}
        )
        tween:Play()
        
        -- Reset velocities
        LocalPlayer.Character.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
        LocalPlayer.Character.HumanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
        
        -- Reset character state
        local humanoid = LocalPlayer.Character:FindFirstChild("Humanoid")
        if humanoid then
            humanoid:ChangeState(2)
        end
    end
end

-- Setup GUI buttons and functionality
FlingButton.MouseButton1Click:Connect(function()
    flingPlayer(FlingInput.Text)
end)

StopFlingButton.MouseButton1Click:Connect(stopFling)

TPGunButton.MouseButton1Click:Connect(function()
    local gun = workspace:FindFirstChild("GunDrop")
    if gun then
        LocalPlayer.Character.HumanoidRootPart.CFrame = gun.CFrame
    end
end)

TPLobbyButton.MouseButton1Click:Connect(function()
    LocalPlayer.Character.HumanoidRootPart.CFrame = workspace.Lobby.CFrame
end)

TPMapButton.MouseButton1Click:Connect(function()
    local map = workspace:FindFirstChild("Map")
    if map then
        LocalPlayer.Character.HumanoidRootPart.CFrame = map:FindFirstChild("Spawn").CFrame
    end
end)

-- Initialize ESP for all players
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        createESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        createESP(player)
    end
end)

-- Auto-shoot loop
game:GetService("RunService").Heartbeat:Connect(function()
    autoShootMurderer()
end)

-- Add a minimize button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -35, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
MinimizeButton.Text = "-"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.TextSize = 20
MinimizeButton.Parent = TopBar

local MinimizeCorner = Instance.new("UICorner")
MinimizeCorner.CornerRadius = UDim.new(0, 6)
MinimizeCorner.Parent = MinimizeButton

local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        MainFrame.Size = UDim2.new(0, 300, 0, 40)
        MinimizeButton.Text = "+"
        ContentFrame.Visible = false
    else
        MainFrame.Size = UDim2.new(0, 300, 0, 400)
        MinimizeButton.Text = "-"
        ContentFrame.Visible = true
    end
end)

-- Add a close button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -70, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = TopBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Make buttons bigger for mobile
local function updateButtonStyle(button)
    button.Size = UDim2.new(1, 0, 0, 45)
    button.TextSize = 16
end

updateButtonStyle(FlingButton)
updateButtonStyle(StopFlingButton)
updateButtonStyle(TPGunButton)
updateButtonStyle(TPLobbyButton)
updateButtonStyle(TPMapButton) 
